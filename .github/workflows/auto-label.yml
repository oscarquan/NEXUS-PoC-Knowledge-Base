name: Auto Label PRs

on:
  pull_request:
    types: [opened, edited]

jobs:
  label-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    
    steps:
    - name: Check PR title for AI content
      uses: actions/github-script@v7
      with:
        script: |
          const title = context.payload.pull_request.title;
          const labels = [];
          
          if (title.includes('[AI-generated]') || title.includes('[AI]')) {
            labels.push('ai-generated', 'needs-review');
          }
          
          if (title.includes('[human-reviewed]')) {
            labels.push('human-reviewed');
            // 移除needs-review如果存在
            const needsReviewIndex = labels.indexOf('needs-review');
            if (needsReviewIndex > -1) {
              labels.splice(needsReviewIndex, 1);
            }
          }
          
          if (title.includes('[experimental]')) {
            labels.push('experimental');
          }
          
          if (labels.length > 0) {
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: labels
            });
          }
