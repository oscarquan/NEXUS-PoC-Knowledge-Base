name: NEXUS Knowledge CI

on:
  push:
    branches: [ main, develop, knowledge/** ]
  pull_request:
    branches: [ main ]

jobs:
  knowledge-validation:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Validate structure
      run: |
        echo "ğŸ” éªŒè¯çŸ¥è¯†åº“ç»“æ„..."
        [ -f "README.md" ] && echo "âœ“ README.md" || echo "âœ— README.md missing"
        [ -d "docs/decisions" ] && echo "âœ“ å†³ç­–æ–‡æ¡£ç›®å½•" || echo "âœ— å†³ç­–æ–‡æ¡£ç¼ºå¤±"
        [ -d "src/knowledge" ] && echo "âœ“ çŸ¥è¯†èŠ‚ç‚¹ç›®å½•" || echo "âœ— çŸ¥è¯†èŠ‚ç‚¹ç›®å½•ç¼ºå¤±"
        
    - name: Check AI markers
      if: github.event_name == 'pull_request'
      run: |
        echo "ğŸ¤– æ£€æŸ¥AIç”Ÿæˆå†…å®¹..."
        PR_TITLE="${{ github.event.pull_request.title }}"
        if echo "$PR_TITLE" | grep -q "\[AI-generated\]"; then
          echo "âš ï¸ AI-GENERATED CONTENT DETECTED"
          echo "::warning::This PR contains AI-generated knowledge nodes. Human review required!"
          echo ""
          echo "ğŸ“‹ çŸ¥è¯†å®¡æŸ¥æ¸…å•:"
          echo "1. âœ… éªŒè¯çŸ¥è¯†å‡†ç¡®æ€§"
          echo "2. âœ… æ£€æŸ¥å…³è”åˆç†æ€§"
          echo "3. âœ… ç¡®è®¤æ— çŸ›ç›¾ä¿¡æ¯"
          echo "4. âœ… æ›´æ–°ç›¸å…³æ–‡æ¡£"
        fi

  documentation-check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Check documentation links
      run: |
        echo "ğŸ“š æ£€æŸ¥æ–‡æ¡£å®Œæ•´æ€§..."
        find docs -name "*.md" | while read file; do
          echo "æ£€æŸ¥: $file"
          if grep -q "TODO\|FIXME" "$file"; then
            echo "âš ï¸  å‘ç°å¾…å®Œæˆé¡¹: $file"
          fi
        done
